<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Health Scanner v5.0 - Accuracy Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

    <style>
        /* THIẾT LẬP FONT QUICKSAND CHO TOÀN BỘ TRANG */
        :root { 
            --navy: #0c2461; 
            --green: #00ff00; 
            --red: #ff3b30; 
        }

        body { 
            margin: 0; 
            font-family: "Quicksand", sans-serif; 
            font-optical-sizing: auto;
            font-weight: 500; /* Độ đậm vừa phải cho dễ đọc */
            background: #f0f2f5; 
        }
        
        header { 
            background: white; 
            padding: 12px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 4px solid var(--navy); 
        }

        /* Dùng font Pacifico cho tên thương hiệu cho nghệ thuật chút nè */
        .brand { 
            font-family: "Quicksand", cursive; 
            font-size: 1.2rem;
            color: var(--navy); 
        }
        
        .main-content { display: flex; flex-direction: column; max-width: 1200px; margin: 10px auto; padding: 0 10px; gap: 15px; }
        @media (min-width: 768px) { .main-content { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; padding: 20px; } }

        .camera-container { background: #000; border-radius: 15px; position: relative; aspect-ratio: 4/3; overflow: hidden; border: 3px solid white; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        
        .card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .status-header { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; font-weight: 800; color: var(--navy); border-left: 4px solid var(--navy); margin-bottom: 12px; }
        
        /* Đảm bảo các nút cũng dùng font mới */
        .btn { 
            width: 100%; 
            padding: 14px; 
            border: none; 
            border-radius: 8px; 
            font-weight: 700; 
            cursor: pointer; 
            background: var(--navy); 
            color: white; 
            margin-bottom: 10px; 
            font-size: 1rem; 
            font-family: "Quicksand", sans-serif;
        }
        .btn-scan { background: #238636 !important; border: 2px solid #00ff00 !important; animation: blink 1.5s infinite; }

        @keyframes blink {
            0% { box-shadow: 0 0 5px #1e90ff; }
            50% { box-shadow: 0 0 20px #00ff00; transform: scale(1.01); }
            100% { box-shadow: 0 0 5px #1e90ff; }
        }

        #res-box { text-align: center; padding: 25px 10px; border-radius: 8px; background: #f8f9fa; border: 2px dashed #ddd; transition: 0.4s; }
        #res-text { font-size: 1.8rem; font-weight: 900; display: block; margin-bottom: 8px; }
        #res-sub { font-size: 0.95rem; font-weight: 600; color: #666; }

        .healthy-bg { background: #e8f5e9 !important; border-color: #2e7d32 !important; }
        .unhealthy-bg { background: #ffebee !important; border-color: #c62828 !important; }
        .healthy-text { color: #2e7d32; }
        .unhealthy-text { color: #c62828; }
    </style>
</head>
<body>

<header>
    <div class="brand">AI Health Scanner v5.0 - PHÂN BIỆT THỨC ĂN LÀNH MẠNH HAY KHÔNG BẰNG AI</div>
    <div id="clock">00:00:00</div>
</header>

<div class="main-content">
    <div class="camera-container">
        <video id="video" autoplay muted playsinline></video>
    </div>

    <div class="control-panel">
        <div class="card">
            <div id="status" class="status-header">Đang tải bộ não AI...</div>
            <button class="btn btn-scan" onclick="enhancedScan()">BẤM ĐỂ QUÉT BẠN ƠI!</button>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn" style="background:#00a8ff" onclick="switchCamera()">XOAY CAMERA</button>
                <button class="btn" style="background:#555" onclick="location.reload()">LÀM MỚI</button>
            </div>
        </div>

        <div class="card">
            <div id="res-box">
                <span id="res-text">SẴN SÀNG</span>
                <span id="res-sub">Hãy đưa thực phẩm lại gần camera</span>
            </div>
        </div>
    </div>
</div>

<script>
    let model;
    let currentStream = null;
    let currentFacingMode = "environment"; 

    const video = document.getElementById('video');
    const status = document.getElementById('status');
    const resBox = document.getElementById('res-box');
    const resText = document.getElementById('res-text');
    const resSub = document.getElementById('res-sub');

    async function startCamera(facingMode) {
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
        }
        try {
            const constraints = { video: { facingMode: facingMode } };
            currentStream = await navigator.mediaDevices.getUserMedia(constraints);
            video.srcObject = currentStream;
        } catch (err) {
            console.error("Lỗi camera: ", err);
            status.innerText = "LỖI CAMERA!";
        }
    }

    function switchCamera() {
        currentFacingMode = (currentFacingMode === "user") ? "environment" : "user";
        startCamera(currentFacingMode);
        status.innerText = `ĐÃ ĐỔI CAMERA ${currentFacingMode === "user" ? "TRƯỚC" : "SAU"}`;
    }

    async function initAI() {
        try {
            model = await mobilenet.load({version: 2, alpha: 1.0});
            status.innerText = "AI ĐÃ ONLINE (v2.0)!";
        } catch (e) {
            status.innerText = "LỖI KẾT NỐI AI!";
        }
    }

    async function enhancedScan() {
        if (!model) return;
        
        status.innerText = "ĐANG PHÂN TÍCH... (0/5)";
        let combinedResults = "";
        
        for(let i = 1; i <= 10; i++) {
            status.innerText = `ĐANG SOI KỸ... (${i}/10)`;
            const predictions = await model.classify(video);
            
            const filtered = predictions
                .filter(p => p.probability > 0.30)
                .map(p => p.className.toLowerCase())
                .join(" ");
            
            combinedResults += filtered + " ";
            await new Promise(r => setTimeout(r, 80)); 
        }

        const badKeywords = [
            "pizza", "burger", "fries", "chips", "hotdog", "fried", "dough", "bread", "noodle", "ramen",
            "candy", "chocolate", "sweet", "sugar", "donut", "cookie", "cake", "ice cream",
            "bottle", "wine", "beer", "can", "pop", "soda", "cola", "coke", "espresso", "sauce",
            "package", "packet", "carton", "box", "plastic", "wrapper", "container", 
            "beaker", "vial", "soft drink", "beverage", "energy drink", "heineken", "pilsner"
        ];

        const isUnhealthy = badKeywords.some(word => combinedResults.includes(word));

        if (isUnhealthy) {
            resText.innerText = "❌ HẠN CHẾ ĂN/UỐNG";
            resText.className = "unhealthy-text";
            resSub.innerText = "Bạn ơi, món này không tốt cho sức khỏe đâu nha!";
            resBox.className = "unhealthy-bg";
            status.style.borderLeftColor = "var(--red)";
        } else {
            resText.innerText = "✅ RẤT LÀNH MẠNH";
            resText.className = "healthy-text";
            resSub.innerText = "Tuyệt vời! Bạn cứ thoải mái thưởng thức nhé.";
            resBox.className = "healthy-bg";
            status.style.borderLeftColor = "var(--green)";
        }
        
        status.innerText = "HOÀN TẤT PHÂN TÍCH!";
    }

    setInterval(() => { 
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('vi-VN'); 
    }, 1000);

    startCamera(currentFacingMode);
    initAI();
</script>
</body>
</html>
