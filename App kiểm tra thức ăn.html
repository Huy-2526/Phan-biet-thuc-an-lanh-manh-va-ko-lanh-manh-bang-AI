<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Health Scanner v3.5 - Huy Special Edition</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

    <style>
        :root { --navy: #0c2461; --green: #00ff00; --red: #ff3b30; --blue-school: #1e90ff; }
        body { margin: 0; font-family: -apple-system, system-ui, sans-serif; background: #f0f2f5; touch-action: manipulation; }
        
        header { background: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--navy); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .brand { font-weight: 800; color: var(--navy); font-size: 1rem; }
        
        .main-content { display: flex; flex-direction: column; max-width: 1200px; margin: 10px auto; padding: 0 10px; gap: 15px; }
        @media (min-width: 768px) { .main-content { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; padding: 20px; } }

        .camera-container { background: #000; border-radius: 15px; position: relative; aspect-ratio: 4/3; overflow: hidden; border: 3px solid white; box-shadow: 0 4px 15px rgba(0,0,0,0.2); width: 100%; }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        
        .card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .status-header { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; font-weight: 800; color: var(--navy); border-left: 4px solid var(--navy); margin-bottom: 12px; font-size: 0.9rem; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; background: var(--navy); color: white; margin-bottom: 10px; font-size: 1rem; }
        .btn-scan { background: #238636 !important; border: 2px solid #00ff00 !important; animation: blink 1.5s infinite; }

        @keyframes blink {
            0% { box-shadow: 0 0 5px #1e90ff; }
            50% { box-shadow: 0 0 20px #00ff00; transform: scale(1.01); }
            100% { box-shadow: 0 0 5px #1e90ff; }
        }

        #res-box { text-align: center; padding: 25px 10px; border-radius: 8px; background: #f8f9fa; border: 2px dashed #ddd; transition: 0.4s; }
        #res-text { font-size: 1.6rem; font-weight: 900; display: block; margin-bottom: 8px; }
        #res-sub { font-size: 0.9rem; font-weight: 600; color: #666; }

        .healthy-bg { background: #e8f5e9 !important; border-color: #2e7d32 !important; }
        .unhealthy-bg { background: #ffebee !important; border-color: #c62828 !important; }
        .healthy-text { color: #2e7d32; }
        .unhealthy-text { color: #c62828; }
        #clock { font-weight: bold; font-size: 0.8rem; }
    </style>
</head>
<body>

<header>
    <div class="brand">AI HEALTH SCANNER v3.5 - HUY</div>
    <div id="clock">00:00:00</div>
</header>

<div class="main-content">
    <div class="camera-container">
        <video id="video" autoplay muted playsinline></video>
    </div>

    <div class="control-panel">
        <div class="card">
            <div id="status" class="status-header">ĐANG TẢI NÃO BỘ AI...</div>
            <button class="btn btn-scan" onclick="scanFood()">QUÉT NGAY BẠN ƠI!</button>
            <button class="btn" style="background:#555" onclick="location.reload()">RESET MÁY</button>
        </div>

        <div class="card">
            <div id="res-box">
                <span id="res-text">READY!</span>
                <span id="res-sub">Hãy đưa món cần soi vào khung hình</span>
            </div>
        </div>
    </div>
</div>

<script>
    let model;
    const video = document.getElementById('video');
    const status = document.getElementById('status');
    const resBox = document.getElementById('res-box');
    const resText = document.getElementById('res-text');
    const resSub = document.getElementById('res-sub');

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(s => video.srcObject = s);

    async function initAI() {
        try {
            model = await mobilenet.load();
            status.innerText = "Hệ thống đã sẵn sàng!";
        } catch (e) {
            status.innerText = "Lỗi kết nối AI!";
        }
    }

    async function scanFood() {
        if (!model) return;
        
        status.innerText = "AI ĐANG PHÂN TÍCH...";
        const predictions = await model.classify(video);
        const results = predictions.map(p => p.className.toLowerCase()).join(" ");
        console.log("AI thấy:", results);

        // DANH SÁCH TẬN DIỆT (CHẶN STING, ĐỒ NGỌT, ĐỒ CHIÊN)
        const badKeywords = [
            "pizza", "burger", "fries", "chips", "hotdog", "fried", "dough", "bread", "noodle", "ramen",
            "candy", "chocolate", "sweet", "sugar", "donut", "cookie", "cake", "ice cream",
            "bottle", "wine", "beer", "can", "pop", "soda", "cola", "coke", "espresso", "sauce",
            "package", "packet", "carton", "box", "plastic", "wrapper", "container"
        ];

        // DANH SÁCH TỐT (RAU CỦ QUẢ TƯƠI)
        const goodKeywords = ["apple", "banana", "orange", "lemon", "broccoli", "cucumber", "carrot", "vegetable", "fruit", "salad"];

        const hasBad = badKeywords.some(word => results.includes(word));
        const hasGood = goodKeywords.some(word => results.includes(word));

        // LOGIC PHÂN BIỆT: Sting thường bị nhận diện là "wine" hoặc "bottle" -> Chặn luôn.
        if (hasBad && !hasGood) {
            resText.innerText = "❌ HẠN CHẾ ĂN";
            resText.className = "unhealthy-text";
            resSub.innerText = "Cái này không tốt cho Huy đâu, đừng dùng nhiều nha!";
            resBox.className = "unhealthy-bg";
        } else if (hasGood) {
            resText.innerText = "✅ ĂN ĐƯỢC";
            resText.className = "healthy-text";
            resSub.innerText = "Món này quá chuẩn! Cứ thế phát huy bạn ơi.";
            resBox.className = "healthy-bg";
        } else {
            resText.innerText = "⚠️ CẨN THẬN";
            resText.className = "";
            resSub.innerText = "AI chưa rõ món này, nhưng cái gì đóng gói thì nên bớt lại.";
            resBox.className = "";
        }
        
        status.innerText = "QUÉT XONG!";
    }

    setInterval(() => { 
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('vi-VN'); 
    }, 1000);

    initAI();
</script>
</body>
</html>

